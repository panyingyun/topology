# Topology 软件迭代计划

本文档基于 [improve-plan.md](./improve-plan.md) 改进建议，将产品路线图拆解为可执行的迭代计划，便于排期、跟踪与验收。

---

## 一、概述

| 项目 | 说明 |
|------|------|
| 参考文档 | [improve-plan.md](./improve-plan.md) |
| 迭代周期 | 2 周 / 迭代（Sprint） |
| 阶段划分 | 第一阶段 1～3 月、第二阶段 3～6 月、第三阶段 6～12 月 |
| 优先级 | P0 最高 → P1 高 → P2 中 → P3 低 |

### 迭代原则

- 每个迭代有明确的目标与可交付成果，支持演示与验收。
- 优先完成 P0，再 P1，再 P2/P3；同一迭代内避免堆叠过多不相关需求。
- 依赖项（如测试框架、PostgreSQL 驱动）优先安排，被依赖项后续排期。
- 文档、测试、重构可与功能迭代并行，计入迭代容量。

---

## 二、迭代模型

- **Sprint 长度**：2 周。
- **产出**：可运行的前/后端功能、文档更新、测试用例或修复等。
- **验收**：每迭代结束进行演示与 Checklist 验收，更新 [improve-plan.md](./improve-plan.md) 与本文档的完成状态。

### 迭代编号规则

- **阶段.迭代**：如 `1.1`、`1.2` 表示第一阶段第 1、2 个迭代。
- **跨迭代任务**：标注为「延续至 1.x」，在对应迭代中拆分子任务。

---

## 三、第一阶段（短期 1～3 个月）

**目标**：完善核心能力，提升稳定性与可维护性。

**对应 improve-plan**：第一阶段（短期）、P0/P1 相关项。

---

### 迭代 1.1（第 1～2 周）

**主题**：PostgreSQL 后端基础 + 测试框架搭建

| 类型 | 任务 | 明细 | 产出 |
|------|------|------|------|
| 功能 | PostgreSQL 驱动接入 | 选用并集成 `pgx` 或 `lib/pq`，实现连接、断线、重试 | 可连接 PostgreSQL、执行简单 SQL |
| 功能 | PG 连接配置与测试 | 连接表单支持 PG（端口、SSL 等），连接测试通过 | 连接管理器支持 PostgreSQL |
| 工程 | 单元测试框架 | 引入测试框架（如 `testing` + 覆盖率），为 1～2 个核心 service 写示例用例 | 可运行的 `go test` 及 CI 集成思路 |
| 文档 | 迭代说明 | 更新本计划 1.1 的完成状态与后续调整 | 迭代总结 |

**验收 Checklist**：

- [ ] 能新增 PostgreSQL 连接并执行 `SELECT 1`。
- [ ] 至少一个后端模块有单元测试且 `go test` 通过。
- [ ] 文档/README 中补充 PG 连接说明（若对外可见）。

**依赖**：无。**被依赖**：1.2、1.3（PG 相关）、后续 PG 特性。

---

### 迭代 1.2（第 3～4 周）

**主题**：PostgreSQL 查询与执行计划 + 错误处理增强

| 类型 | 任务 | 明细 | 产出 |
|------|------|------|------|
| 功能 | PG 查询执行 | 复用现有查询执行流程，支持 PG 占位符与结果集解析 | PG 上可执行任意 SELECT，结果正确展示 |
| 功能 | PG 执行计划 | 支持 `EXPLAIN (ANALYZE) VERBOSE` 等，前端解析并展示（可复用现有执行计划 UI） | PG 执行计划可查看 |
| 功能 | 错误处理增强 | 统一错误码/错误信息结构，后端返回可解析错误；前端友好提示（improve-plan 13.(1)） | 常见错误有明确提示，无裸 `panic` 堆栈 |
| 工程 | 测试 | 为 PG 连接与查询、错误处理路径补充单元/集成测试 | 新增用例通过 |

**验收 Checklist**：

- [ ] PostgreSQL 上执行查询、查看执行计划与结果。
- [ ] 连接失败、语法错误等场景有清晰用户提示。
- [ ] 相关测试覆盖并通过。

**依赖**：1.1。**对应 improve-plan**：1.(1) PostgreSQL、7.(1) 错误处理、13.(1)。

---

### 迭代 1.3（第 5～6 周）

**主题**：PostgreSQL 特性补齐 + SQL 智能提示（一期）

| 类型 | 任务 | 明细 | 产出 |
|------|------|------|------|
| 功能 | PG 元数据与 Schema | 实现 PG 的库/表/列/索引等元数据查询，与现有 Schema 抽象对齐 | 侧边栏可展示 PG 库表结构 |
| 功能 | PG 特色类型（可选） | 数组、JSON/JSONB 等类型的展示与编辑（可先只读展示） | 基础支持 |
| 功能 | SQL 智能提示（一期） | 基于当前连接元数据：表名、列名补全；关键字补全（improve-plan 2.(1)） | 输入时出现补全列表 |
| 工程 | 自动化测试 | 扩展 E2E 或集成测试：连接 PG、执行查询、查看结果与计划 | 核心路径有自动化覆盖 |

**验收 Checklist**：

- [ ] PG 数据库在侧边栏有完整树形结构。
- [ ] SQL 编辑器具备表/列/关键字补全。
- [ ] 新增/更新的 E2E 或集成测试通过。

**依赖**：1.1、1.2。**对应 improve-plan**：1.(1)、2.(1) SQL 智能提示。

---

### 迭代 1.4（第 7～8 周）

**主题**：备份恢复（一期）+ 日志系统基础

| 类型 | 任务 | 明细 | 产出 |
|------|------|------|------|
| 功能 | 备份恢复（一期） | MySQL：`mysqldump` 封装；PG：`pg_dump` 封装；可选 SQLite 导出；提供「立即备份」与保存路径 | 支持全量备份并保存到本地文件 |
| 功能 | 备份记录与恢复 | 记录最近 N 次备份路径/时间；提供「从备份恢复」入口（调用 `mysql`/`psql` 等还原） | 可一键恢复指定备份（需确认） |
| 功能 | 日志系统 | 分级日志（DEBUG/INFO/WARN/ERROR），输出到文件与可配置级别（improve-plan 13.(4)） | 运行日志可查、可排错 |
| 工程 | 测试与文档 | 备份/恢复流程的测试；用户文档中增加备份恢复说明 | 文档与用例更新 |

**验收 Checklist**：

- [ ] MySQL / PostgreSQL 可执行全量备份并选择保存位置。
- [ ] 可从已有备份执行恢复（含二次确认）。
- [ ] 应用产生分级日志文件，便于排查问题。

**依赖**：1.1、1.2。**对应 improve-plan**：8. 备份恢复、13.(4) 日志系统。

---

### 迭代 1.5（第 9～10 周）

**主题**：定时备份 + 用户文档完善

| 类型 | 任务 | 明细 | 产出 |
|------|------|------|------|
| 功能 | 定时备份 | Cron 表达式或简单周期（每日/每周）配置；后台调度执行备份（improve-plan 8.(1)） | 支持按周期自动备份 |
| 功能 | 备份管理界面 | 备份列表、删除、导出；备份验证（如校验文件存在、大小） | 备份管理页可用 |
| 文档 | 用户文档 | 快速入门、连接配置、查询与执行计划、备份恢复、常见问题（improve-plan 12.(1)） | 结构清晰的用户文档 |
| 文档 | 开发者文档 | 架构概览、本地构建与运行、目录说明、贡献指南骨架 | 开发者可据此参与开发 |

**验收 Checklist**：

- [ ] 可配置定时备份并实际触发。
- [ ] 备份列表可查看、删除、简单验证。
- [ ] 用户文档与开发者文档已更新并可访问。

**依赖**：1.4。**对应 improve-plan**：8.(1)(2)、12.(1)(4)。

---

### 迭代 1.6（第 11～12 周）

**主题**：稳定性收尾 + 第一阶段复盘

| 类型 | 任务 | 明细 | 产出 |
|------|------|------|------|
| 工程 | 错误恢复与报告 | 未捕获异常的可选上报、友好错误页或弹窗（improve-plan 13.(1)） | 崩溃类问题有更好反馈 |
| 工程 | 测试与质量 | 补充单元/集成/E2E 用例；修复高优先级 Bug；简单性能检查（如大结果集） | 测试覆盖与稳定性提升 |
| 文档 | 第一阶段总结 | 完成项、已知限制、下一阶段优先级 | 复盘文档与计划更新 |
| 可选 | 视频教程 | 快速入门演示视频（improve-plan 12.(2)） | 1 支入门视频 |

**验收 Checklist**：

- [ ] 主要流程有自动化测试保障。
- [ ] 已知 P0/P1 Bug 已修复或已登记。
- [ ] 第一阶段总结已输出，第二阶段迭代可启动。

**依赖**：1.1～1.5。**对应 improve-plan**：13.(1)(2)、12.(2) 可选。

---

## 四、第二阶段（中期 3～6 个月）

**目标**：增强用户体验与数据操作能力，引入可视化和部分高级功能。

**对应 improve-plan**：第二阶段（中期）、部分 P1/P2。

---

### 迭代 2.1（第 13～14 周）

**主题**：查询缓存 + 索引建议（一期）

| 类型 | 任务 | 明细 | 产出 |
|------|------|------|------|
| 功能 | 查询结果缓存 | 相同 SQL+参数的结果缓存；TTL 或条数上限；缓存命中率统计（improve-plan 4.(2)） | 重复查询可命中缓存，有基础统计 |
| 功能 | 索引建议（一期） | 解析慢查询日志或执行计划，识别缺失索引场景，生成 `CREATE INDEX` 建议 | 可展示索引建议列表 |
| 工程 | 性能测试 | 针对大表、大结果集的查询与缓存做简单压测或脚本 | 性能基线与回归手段 |

**验收 Checklist**：

- [ ] 相同查询可命中缓存，界面有命中提示或统计。
- [ ] 至少一种数据源可产出索引建议。
- [ ] 性能测试脚本可复现运行。

**对应 improve-plan**：4.(2) 查询缓存、4.(3) 索引建议。

---

### 迭代 2.2（第 15～16 周）

**主题**：批量数据操作 + 事务支持（一期）

| 类型 | 任务 | 明细 | 产出 |
|------|------|------|------|
| 功能 | 批量操作 | 多选行、批量删除；批量修改（同列同值）；Excel 式批量粘贴新增行（improve-plan 3.(1)） | 表视图支持批量删、改、粘贴增 |
| 功能 | 事务支持（一期） | 手动开启/提交/回滚事务；当前连接事务状态展示（improve-plan 3.(3)） | 可显式控制事务 |
| 功能 | 数据验证 | 基础类型与非空校验；违反时提示不提交（improve-plan 3.(2) 子集） | 编辑时基本校验 |

**验收 Checklist**：

- [ ] 支持多选后批量删除、批量修改。
- [ ] 支持从剪贴板粘贴多行并插入。
- [ ] 可开启/提交/回滚事务，状态可见。

**对应 improve-plan**：3.(1)(2)(3)。

---

### 迭代 2.3（第 17～18 周）

**主题**：Undo/Redo + 查询模板与参数化

| 类型 | 任务 | 明细 | 产出 |
|------|------|------|------|
| 功能 | Undo/Redo | 表数据编辑的操作历史栈；Ctrl+Z / Ctrl+Y 撤销重做（improve-plan 3.(4)） | 编辑可撤销、重做 |
| 功能 | 查询模板库 | 内置常用 SQL 模板；用户自定义模板的增删改（improve-plan 2.(3)） | 模板管理可用 |
| 功能 | 参数化查询 | SQL 中 `:name` 或 `?` 占位符；执行前弹窗输入参数；参数历史（improve-plan 2.(4)） | 支持参数化执行 |

**验收 Checklist**：

- [ ] 表格编辑支持 Undo/Redo 及快捷键。
- [ ] 可管理内置与自定义模板。
- [ ] 参数化 SQL 可输入参数并执行。

**对应 improve-plan**：2.(3)(4)、3.(4)。

---

### 迭代 2.4（第 19～20 周）

**主题**：ER 图与执行计划增强

| 类型 | 任务 | 明细 | 产出 |
|------|------|------|------|
| 功能 | ER 图（一期） | 从当前库/表生成 ER 图；表、外键关系展示；导出 PNG/SVG（improve-plan 5.(1)） | 可查看、导出 ER 图 |
| 功能 | 执行计划增强 | 计划对比（两次执行）；耗时占比可视化；优化建议文案展示（improve-plan 5.(2)） | 计划对比与可读性提升 |
| 工程 | 测试 | ER 图、执行计划相关的前端与集成测试 | 相关用例通过 |

**验收 Checklist**：

- [ ] 可选库/表生成 ER 图并导出。
- [ ] 支持两次执行计划对比与简单优化建议。

**对应 improve-plan**：5.(1)(2)。

---

### 迭代 2.5（第 21～22 周）

**主题**：数据对比与 Schema 同步（一期）

| 类型 | 任务 | 明细 | 产出 |
|------|------|------|------|
| 功能 | 数据对比 | 两数据源间表数据 diff；差异高亮与导出报告（improve-plan 14.(1)） | 可对比两表数据并生成报告 |
| 功能 | Schema 同步（一期） | 检测两环境表结构差异；生成 `ALTER`/`CREATE` 等同步脚本（improve-plan 14.(2)） | 可生成同步脚本 |
| 文档 | 用户文档 | 数据对比、Schema 同步的使用说明 | 文档更新 |

**验收 Checklist**：

- [ ] 支持选择两表进行数据对比并查看差异。
- [ ] 可生成 Schema 同步用的 SQL脚本。

**对应 improve-plan**：14.(1)(2)。

---

### 迭代 2.6（第 23～24 周）

**主题**：权限与审计（一期）+ 第二阶段复盘

| 类型 | 任务 | 明细 | 产出 |
|------|------|------|------|
| 功能 | 权限管理（一期） | 多用户/角色；库表级只读可写权限；连接级权限（improve-plan 7.(1) 子集） | 基础 RBAC 可用 |
| 功能 | 审计日志（一期） | 记录查询、结构变更等关键操作；时间、用户、SQL；查询与导出（improve-plan 7.(2)） | 操作可审计、可查 |
| 文档 | 第二阶段总结 | 完成项、遗留项、第三阶段优先级 | 复盘与计划更新 |

**验收 Checklist**：

- [ ] 可配置角色与库表权限并生效。
- [ ] 关键操作有审计记录并可查询。

**对应 improve-plan**：7.(1)(2)。

---

## 五、第三阶段（长期 6～12 个月）

**目标**：差异化能力、扩展性与生态建设。

**对应 improve-plan**：第三阶段（长期）、P2/P3。

---

### 迭代 3.1～3.2（第 25～28 周）

**主题**：插件系统与扩展性

| 迭代 | 任务 | 产出 |
|------|------|------|
| 3.1 | 插件 API 设计；插件加载与生命周期；示例插件 | 可加载、卸载示例插件 |
| 3.2 | 插件配置、菜单/工具栏扩展点；插件开发文档与示例 | 文档与 2～3 个示例插件 |

**对应 improve-plan**：11.(1) 插件系统。

---

### 迭代 3.3～3.4（第 29～32 周）

**主题**：更多数据库与跨库能力

| 迭代 | 任务 | 产出 |
|------|------|------|
| 3.3 | MongoDB 或 Redis 连接与基础 CRUD；NoSQL 结果展示 | 至少一种 NoSQL 可用 |
| 3.4 | 跨库查询（同类型多库）或联邦查询 PoC；结果合并展示 | 跨库查询原型 |

**对应 improve-plan**：1.(2) 扩展数据库、14.(3) 跨数据库查询。

---

### 迭代 3.5～3.6（第 33～36 周）

**主题**：协作与共享

| 迭代 | 任务 | 产出 |
|------|------|------|
| 3.5 | 团队共享连接；连接加密存储与权限（improve-plan 6.(2)） | 共享连接可管理、可使用 |
| 3.6 | SQL 脚本版本控制（Git 集成）或查询分享链接（improve-plan 6.(1)(3)） | 脚本版本管理或分享之一 |

**对应 improve-plan**：6.(1)(2)(3)。

---

### 迭代 3.7～3.8（第 37～40 周）

**主题**：开发者工具

| 迭代 | 任务 | 产出 |
|------|------|------|
| 3.7 | 迁移工具（类似 Flyway）：版本表、迁移脚本执行与回滚（improve-plan 10.(1)） | 可运行迁移与回滚 |
| 3.8 | Mock 数据生成（按表结构）；ORM/代码生成（一种语言）（improve-plan 10.(2)(4)） | Mock 生成或代码生成可用 |

**对应 improve-plan**：10.(1)(2)(4)。

---

### 迭代 3.9～3.10（第 41～44 周）

**主题**：AI 辅助与智能优化

| 迭代 | 任务 | 产出 |
|------|------|------|
| 3.9 | 自然语言转 SQL PoC（对接 LLM API）；或 SQL 优化建议增强（improve-plan 9.(1)(2)） | 至少一种 AI 能力可用 |
| 3.10 | 智能补全增强；数据洞察或质量评分试点（improve-plan 9.(3)(4)） | 补全或洞察能力增强 |

**对应 improve-plan**：9.

---

### 迭代 3.11～3.12（第 45～48 周）

**主题**：数据血缘、社区与收尾

| 迭代 | 任务 | 产出 |
|------|------|------|
| 3.11 | 数据血缘分析（表/列级）；简单血缘图展示（improve-plan 14.(5)） | 血缘图可查看 |
| 3.12 | 社区/论坛或视频教程扩充；插件市场雏形；全年总结与下年规划 | 社区与生态有进展 |

**对应 improve-plan**：12.(2)(3)、14.(5)、11.(1) 插件市场。

---

## 六、Roadmap 与依赖示意

### 阶段总览

```
第一阶段(1～3月)    第二阶段(3～6月)      第三阶段(6～12月)
 1.1 → 1.2 → 1.3    2.1 → 2.2 → 2.3      3.1 → ... → 3.12
 1.4 → 1.5 → 1.6    2.4 → 2.5 → 2.6
     │                    │
     └── PG + 稳定 + 文档  └── 性能 + 编辑 + 可视化 + 对比
```

### 关键依赖

- **PostgreSQL 全流程**：1.1 → 1.2 → 1.3。
- **备份恢复**：1.4 → 1.5（定时与 UI）。
- **查询缓存 / 索引建议**：2.1 可独立，为后续优化打基础。
- **批量与事务**：2.2 为 2.3 Undo/Redo 提供操作基础。
- **插件系统**：3.1～3.2 为插件市场、扩展主题等打基础。

### 风险与缓冲

- 每阶段预留 0.5～1 个迭代作为缓冲（修 Bug、文档、技术债）。
- 若某迭代延期，优先保证 P0/P1 交付，P2/P3 可后移。

---

## 七、与 improve-plan 的对应关系

| improve-plan 章节 | 主要落地迭代 |
|-------------------|--------------|
| 1. 数据库支持完善 | 1.1～1.3（PostgreSQL）；3.3～3.4（扩展库、跨库） |
| 2. 查询功能增强 | 1.3（智能提示）；2.3（模板、参数化）；2.6（审计） |
| 3. 数据编辑能力 | 2.2（批量、事务）；2.3（Undo/Redo）；2.2（验证） |
| 4. 性能优化 | 2.1（缓存、索引建议） |
| 5. 可视化增强 | 2.4（ER、执行计划） |
| 6. 协作功能 | 3.5～3.6 |
| 7. 权限管理 | 2.6；3.5（共享连接） |
| 8. 备份恢复 | 1.4～1.5 |
| 9. AI 辅助 | 3.9～3.10 |
| 10. 开发者工具 | 3.7～3.8 |
| 11. 扩展性 | 3.1～3.2；3.12（插件市场） |
| 12. 文档与社区 | 1.5～1.6；3.12 |
| 13. 稳定性与质量 | 1.1～1.2；1.6 |
| 14. 差异化功能 | 2.4～2.5；3.11（血缘） |

---

## 八、迭代执行与更新

- **迭代前**：从本计划拆解当轮 Sprint Backlog，明确负责人与验收标准。
- **迭代中**：按需更新任务状态；阻塞项及时升级。
- **迭代后**：完成验收 Checklist，更新本文档的「完成状态」和 [improve-plan.md](./improve-plan.md) 的勾选；同步下一迭代范围。

---

## 九、迭代完成状态追踪

随迭代推进更新下表，便于总览进度。

| 迭代 | 主题概要 | 状态 | 完成日期 |
|------|----------|------|----------|
| 1.1 | PostgreSQL 基础 + 测试框架 | 待开始 | - |
| 1.2 | PG 查询/计划 + 错误处理 | 待开始 | - |
| 1.3 | PG 特性 + SQL 智能提示一期 | 待开始 | - |
| 1.4 | 备份恢复一期 + 日志 | 待开始 | - |
| 1.5 | 定时备份 + 文档 | 待开始 | - |
| 1.6 | 稳定性收尾 + 阶段复盘 | 待开始 | - |
| 2.1 | 查询缓存 + 索引建议 | 待开始 | - |
| 2.2 | 批量操作 + 事务 | 待开始 | - |
| 2.3 | Undo/Redo + 模板与参数化 | 待开始 | - |
| 2.4 | ER 图 + 执行计划增强 | 待开始 | - |
| 2.5 | 数据对比 + Schema 同步 | 待开始 | - |
| 2.6 | 权限与审计 + 阶段复盘 | 待开始 | - |
| 3.1～3.12 | 插件、多库、协作、AI、血缘等 | 待开始 | - |

**状态**：待开始 / 进行中 / 已完成。

---

*文档版本：1.0*  
*创建日期：基于 improve-plan 生成*  
*维护：随迭代进展更新*
