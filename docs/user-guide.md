# Topology 用户指南

## 一、快速入门

1. **启动应用**：运行 Topology 后，主界面左侧为连接与数据库树，右侧为多标签工作区。
2. **新建连接**：点击侧栏「新建连接」，填写数据库类型（MySQL / PostgreSQL / SQLite）、主机、端口、用户名、密码、数据库名等，保存后即可在树中展开查看库表。
3. **执行查询**：在侧栏表上右键选择「查询」，或直接打开查询标签，输入 SQL 后点击「执行」或按 `Ctrl+Enter` 查看结果。
4. **查看表数据**：点击侧栏中的表名，在表数据标签中可浏览、筛选、编辑并保存修改。

## 二、连接配置

- **支持的数据库**：MySQL、PostgreSQL、SQLite。
- **连接信息保存**：连接保存在用户配置目录（如 `~/.config/topology/connections.json`），密码经加密存储。
- **导入 Navicat**：侧栏「导入 Navicat」可选择 `.ncx` 文件，自动创建 MySQL/SQLite 连接（密码需在连接管理中补填）。
- **连接操作**：右键连接可进行编辑、刷新、立即备份、从备份恢复、打开监控（仅 MySQL）、删除等操作。

## 三、查询与执行计划

- **SQL 编辑器**：基于 Monaco，支持语法高亮、自动补全、格式化。可拖拽调节 SQL 与结果区域比例。
- **执行与历史**：`Ctrl+Enter` 执行当前 SQL；「历史」面板可搜索、选择历史查询重新执行。
- **执行计划**：仅 MySQL、PostgreSQL 支持。在查询窗口点击「执行计划」，对当前 SQL 执行 `EXPLAIN`，结果以树形展示（全表扫描、索引使用、优化建议等）。
- **查询结果**：支持导出为 CSV、JSON、SQL Insert；双击单元格可复制内容到剪贴板。

## 四、备份与恢复

### 4.1 立即备份与恢复

- **立即备份**：连接右键「立即备份」，选择保存路径后，将调用 `mysqldump`（MySQL）、`pg_dump`（PostgreSQL）或 `sqlite3 .dump`（SQLite）生成 SQL 备份文件。最近 50 次备份会记录在备份列表中。
- **从备份恢复**：连接右键「从备份恢复」，从最近备份列表选择或「选择文件」指定备份文件，确认后将执行恢复（会覆盖目标库数据，需谨慎）。

### 4.2 定时备份

- **备份管理**：侧栏「备份管理」打开备份管理界面。
- **定时备份**：在「定时备份」标签中添加计划，选择连接、周期（每日 / 每周）、执行时间（如 `02:00`），可选自定义输出目录；保存后由应用后台按周期自动执行备份。
- **备份列表**：在「备份列表」中可查看近期备份、验证文件是否存在及大小、删除不再需要的备份记录与文件。

### 4.3 说明与限制

- 备份与恢复依赖本机已安装的 `mysqldump` / `mysql`、`pg_dump` / `psql`、`sqlite3`，且需在系统 `PATH` 中。
- 通过 SSH 隧道的连接暂不支持备份与恢复。

## 五、常见问题

**Q：连接失败，提示连接被拒绝？**  
A：确认数据库服务已启动，主机、端口、防火墙设置正确；若通过 SSH 隧道，请先配置并启用隧道。

**Q：执行计划为什么是灰的 / 不支持？**  
A：执行计划仅支持 MySQL 与 PostgreSQL；SQLite 暂不支持。

**Q：定时备份没有执行？**  
A：确认计划已启用（ON）、时间格式为 `HH:MM`（24 小时制），且对应连接类型为 MySQL / PostgreSQL / SQLite。可查看 `~/.config/topology/logs/topology.log` 是否有相关日志。

**Q：备份文件保存在哪里？**  
A：立即备份由用户在弹窗中选择路径。定时备份默认保存在用户配置目录下的 `topology/backups/`，或在计划中配置的「输出目录」。

**Q：如何查看运行日志？**  
A：日志文件路径为 `用户配置目录/topology/logs/topology.log`。可通过环境变量 `TOPOLOGY_LOG_LEVEL`（如 `DEBUG`、`INFO`、`WARN`、`ERROR`）调节日志级别。

**Q：如何切换界面语言？**  
A：点击标题栏右侧语言切换按钮，在中文与英文之间切换，偏好会持久化保存。

---

更多功能与更新见项目 [README](../README.md)。
